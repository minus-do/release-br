name: release

on:
  workflow_dispatch:
    inputs:
      tag:
        type: string
      update-release:
        type: choice
        default: false
        options:
          - 'true'
          - 'false'
      release-new-version:
        type: string
        default: ''
        required: false
      set-latest:
        type: choice
        default: false
        options:
          - 'true'
          - 'false'

    
     

jobs:
  update-create-release:
    runs-on: ubuntu-latest

    steps:

      - name: create a new release based on tag
        if: ${{ inputs.update-release == 'true' }}
        run: |
          release_id=$(gh release view ${{ inputs.tag }} --json id --jq '.id')
          gh api \
            --method PATCH \
            -H "Accept: application/vnd.github+json" \
            -H "X-GitHub-Api-Version: 2022-11-28" \
            /repos/${{ github.repository }}/releases/$release_id \
            -f tag_name="${{ inputs.tag }}" \
            -f name="${{ inputs.release-new-version }}" \
            -F draft=false \
            -F prerelease=false

        env:
          GH_TOKEN: ${{ secrets.MY_PAT }}


      - name: modify a release
        if: ${{ inputs.update-release == 'false' }}
        run: |
          gh release create ${{ inputs.tag }} --title ${{ inputs.tag }} --latest false
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
